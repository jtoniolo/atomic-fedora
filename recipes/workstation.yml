# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
name: atomic-workstation
description: ThinkPad T14 AMD developer & gaming workstation.

base-image: ghcr.io/ublue-os/aurora-dx
image-version: stable

modules:
  - type: files
    files:
      - source: keys
        destination: /tmp/keys # copies files/keys/* into /tmp/keys/ in the image
      - source: rpms
        destination: /tmp/rpms # copies files/rpms/* into /tmp/rpms/ in the image
      - source: prebuilt-modules
        destination: /tmp/prebuilt-modules # copies files/prebuilt-modules/* into /tmp/prebuilt-modules/ in the image
      - source: system
        destination: /

  # --- FIX: Use 'containerfile' for inline commands instead of 'script' ---
  - type: containerfile
    snippets:
      - RUN systemctl mask power-profiles-daemon.service

  - type: dnf
    repos:
      files:
        - antigravity.repo
      copr:
        - atim/starship
    install:
      packages:
        # --- AI CODING ASSISTANT ---
        - antigravity

        # --- THINKPAD T14 GEN 2 AMD HARDWARE ---
        - fwupd
        - radeontop
        - libva-utils
        - acpi
        - tlp
        - tlp-rdw

        # --- SHELL & CORE UTILITIES ---
        - micro
        - bat
        - ripgrep
        - p7zip
        - p7zip-plugins
        - ncdu
        - btop
        - duf

        # --- SYSTEM ADMIN ---
        - btrfs-assistant
        - snapper

  - type: systemd
    system:
      enabled:
        - sshd.service
        - cups.service
        - tailscaled.service
        - tlp.service
        #- cockpit.socket

  - type: default-flatpaks
    configurations:
      - notify: true
        scope: system
        install:
          # --- BROWSERS ---
          - org.mozilla.firefox
          - com.google.Chrome
          - com.brave.Browser
          - com.microsoft.Edge

          # --- DEVELOPMENT ---
          - com.getpostman.Postman
          - io.dbeaver.DBeaverCommunity
          - com.mongodb.Compass
          - rest.insomnia.Insomnia
          - io.podman_desktop.PodmanDesktop

          # --- GAMING ---
          - org.prismlauncher.PrismLauncher
          - com.valvesoftware.Steam
          - com.heroicgameslauncher.hgl
          - net.lutris.Lutris
          - net.davidotek.pupgui2
          - org.gnome.Mahjongg

          # --- PRODUCTIVITY & TOOLS ---
          - com.github.tchx84.Flatseal
          - com.bitwarden.desktop
          - org.onlyoffice.desktopeditors
          - org.libreoffice.LibreOffice
          - com.nextcloud.desktopclient.nextcloud
          - com.actualbudget.actual
          - org.kde.kcalc
          - org.localsend.localsend_app
          - io.github.kolunmi.Bazaar
          - md.obsidian.Obsidian

          # --- COMMUNICATION & MESSAGING ---
          - com.discordapp.Discord
          - us.zoom.Zoom

          # --- MEDIA ---
          - org.videolan.VLC
          - com.obsproject.Studio
          - com.spotify.Client
          - com.plexamp.Plexamp
          - tv.plex.PlexDesktop

  # Custom DisplayLink EVDI installation script
  - type: displaylink
    source: local
    options:
      rpm_package: /tmp/rpms/fedora-42-displaylink-1.14.10-1.github_evdi.x86_64.rpm
      signing_keys_dir: /tmp/keys
      evdi_git_repo: https://github.com/DisplayLink/evdi.git
      cleanup_build_deps: true

  - type: signing
