# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
name: atomic-workstation
description: ThinkPad T14 AMD developer & gaming workstation.

base-image: ghcr.io/ublue-os/aurora-dx
image-version: latest

modules:
  - type: files
    files:
      - source: system
        destination: /

  # --- SCRIPTS & FIXES ---
  - type: script
    scripts:
      # TLP requires masking the default power-profiles-daemon to function
      - name: "disable-ppd"
        script: |
          systemctl mask power-profiles-daemon.service

  - type: dnf
    repos:
      # Removed vscode.repo (Code is built-in to aurora-dx)
      # Removed webmin.repo (Replaced with Cockpit)
      copr:
        - atim/starship # Kept just in case, but usually built-in
    install:
      packages:
      # --- THINKPAD T14 GEN 2 AMD HARDWARE ---
        - fwupd             # Firmware updates
        - radeontop         # GPU Monitor for Ryzen Vega
        - libva-utils       # Video acceleration verification
        - acpi              # Battery status
        - tlp               # Battery life optimization
        - tlp-rdw           # Radio wizard
        - smartmontools     # NVMe/SSD health monitoring

      # --- SHELL & CORE UTILITIES ---
      # Removed: starship, fzf, zoxide, distrobox, tailscale (Built-in to Aurora-DX)
      # Removed: code, nodejs (VS Code is built-in; use DevContainers/Homebrew for Node)
        - micro             # Easy terminal editor
        - fastfetch         # System info
        - bat               # Cat replacement
        - ripgrep           # Better grep
        - tmux              # Multiplexer
        - p7zip             # Archives
        - p7zip-plugins
        - lazygit           # Git UI
        - powertop          # Power monitoring
        - htop
        - ncdu              # Disk usage
        - rsync
        - bind-utils        # Dig/Nslookup
        - iotop
        - btop              # Better Htop
        - duf               # Disk Usage Free

        # --- SYSTEM ADMIN ---
        - cockpit           # Web Console (Modern Webmin replacement)
        - cockpit-podman    # Manage containers via Web UI
        - cockpit-networkmanager
        - gutenprint        # Printer drivers

  - type: systemd
    system:
      enabled:
        - sshd.service
        - cups.service
        - tailscaled.service
        - tlp.service       # Enable TLP
        - cockpit.socket    # Enable Web Console (Access at localhost:9090)

  - type: default-flatpaks
    configurations:
      - notify: true
        scope: system
        install:
          # --- BROWSERS ---
          - org.mozilla.firefox
          - com.google.Chrome
          - com.brave.Browser
          - com.microsoft.Edge

          # --- DEVELOPMENT ---
          # Removed: com.visualstudio.code (Use the host version included in Aurora-DX)
          - com.getpostman.Postman
          - io.dbeaver.DBeaverCommunity
          - com.mongodb.Compass
          - com.axosoft.GitKraken
          - rest.insomnia.Insomnia

          # --- GAMING ---
          - org.prismlauncher.PrismLauncher
          - com.valvesoftware.Steam
          - com.heroicgameslauncher.hgl
          - net.lutris.Lutris
          - net.davidotek.pupgui2          # ProtonUp-Qt

          # --- PRODUCTIVITY & TOOLS ---
          - com.github.tchx84.Flatseal     # Permissions Manager
          - com.bitwarden.desktop
          - org.onlyoffice.desktopeditors
          - org.libreoffice.LibreOffice
          - com.nextcloud.desktopclient.Nextcloud
          - org.kde.kcalc
          - org.localsend.localsend_app
          - com.actualbudget.actualbudget

          # --- MEDIA ---
          - org.videolan.VLC
          - com.obsproject.Studio
          - com.spotify.Client

  - type: signing